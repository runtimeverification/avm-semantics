// This is an example testing scenario for the new AVM/TEAL semantics that supports transaction groups.
//
// Initial network state
//   Apps: a stateful app that counts how many times it has been called
//         State: (one global Int, one local Int)
//   Accounts: one account that is the app's creator and had opted into the app
//   Assets: none
//
// Transaction group: tree app calls from the account to the app
//
// Expected effect on the apps state:
//   (Global 0, Local [(account 1, 0), (account 2, 0)]) =>
//   (Global 3, Local [(account 1, 2), (account 2, 1)])

declareTealSource "count_calls.teal";
declareTealSource "clear-basic.teal";

addAccount <address> b"1" </address> <balance> 357000 </balance>;
addAccount <address> b"2" </address> <balance> 228500 </balance>;

#initTxGroup();

// Add app and opt in b"1"
addAppCallTx <txID> 0 </txID>
             <sender>            b"1"        </sender>
             <applicationID>     0           </applicationID>
             <onCompletion>      @ OptIn     </onCompletion>
             <accounts>          .TValueList </accounts>
             <applicationArgs>   .TValueList </applicationArgs>
             <foreignApps>       .TValueList </foreignApps>
             <foreignAssets>     .TValueList </foreignAssets>
             <globalNui>         1           </globalNui>
             <globalNbs>         0           </globalNbs>
             <localNui>          1           </localNui>
             <localNbs>          0           </localNbs>
             <extraProgramPages> 0           </extraProgramPages>
             <approvalPgmIdx>    0           </approvalPgmIdx>
             <clearStatePgmIdx>  1           </clearStatePgmIdx>;

// Opt in b"2"
addAppCallTx <txID> 1 </txID>
             <sender>            b"2"        </sender>
             <applicationID>     1           </applicationID>
             <onCompletion>      @ OptIn     </onCompletion>
             <accounts>          .TValueList </accounts>
             <applicationArgs>   .TValueList </applicationArgs>
             <foreignApps>       .TValueList </foreignApps>
             <foreignAssets>     .TValueList </foreignAssets>
             <globalNui>         0           </globalNui>
             <globalNbs>         0           </globalNbs>
             <localNui>          0           </localNui>
             <localNbs>          0           </localNbs>
             <extraProgramPages> 0           </extraProgramPages>
             <approvalPgmIdx>    0           </approvalPgmIdx>
             <clearStatePgmIdx>  1           </clearStatePgmIdx>;

// Call app from b"1"
addAppCallTx <txID> 2 </txID>
             <sender>            b"1"        </sender>
             <applicationID>     1           </applicationID>
             <onCompletion>      @ NoOp      </onCompletion>
             <accounts>          .TValueList </accounts>
             <applicationArgs>   .TValueList </applicationArgs>
             <foreignApps>       .TValueList </foreignApps>
             <foreignAssets>     .TValueList </foreignAssets>
             <globalNui>         0           </globalNui>
             <globalNbs>         0           </globalNbs>
             <localNui>          0           </localNui>
             <localNbs>          0           </localNbs>
             <extraProgramPages> 0           </extraProgramPages>
             <approvalPgmIdx>    0           </approvalPgmIdx>
             <clearStatePgmIdx>  1           </clearStatePgmIdx>;

#initGlobals();
#evalTxGroup();
.AS
